<!DOCTYPE html>
<html>
<!--
        QUIZ GAME!

        RULES:
        / The player must guess correctly a certain amount of questions
        / Each correct answer gives him one point
        / Answers could be multiple or true/false
        / At the end of the game, the user must know his total score

        QUESTIONS:
        / You can get them from this URL ( http://bit.ly/strive_QUIZZ ) or you can write your own
        / Could be multiple of boolean (true / false)
        / [EXTRA] Show if the answer was wrong or correct after clicking
        / [EXTRA] Present them one a time

        HINTS:
        / Keep a global variable score for the score
        / Keep a variable questionNumber for the question the user is answering
        / When questionNumber is bigger then the available questions, present the score
        / Start working with the question saved in a variable, and then include AJAX etc
        / Start with the easier version and THEN implement the EXTRAs
        / Please debug everything / try it on the console to be sure of what to expect from your code

        EXTRA:
        / Show if the answer was wrong or correct after clicking
        / Present questions one a time
        / Let the user select difficulty and number of questions (you can get q/a from https://opentdb.com/api.php?amount=10&category=18&difficulty=easy modifying amount and difficulty)

    -->
<style>
  @font-face {
    font-family: "Hacked";
    src: url(https://hackedfont.com/HACKED.ttf);
  }

  * {
    font-family: Hacked;
    margin: 5px;
  }

  body {
    margin-top: 150px;
    background-color: royalblue;
  }

  .row {
    display: grid;
    justify-content: center;
    text-align: center;
  }

  #question {
    text-align: center;
  }

  .correct-answer {
    background-color: green;
  }

  .incorrect-answer {
    background-color: red;
  }

  button {
    min-width: 400px;
    min-height: 100px;
    padding: 0.5em 3em;
    border: 0.16em solid #FFFFFF;
    margin: 5px;
    box-sizing: border-box;
    text-decoration: none;
    text-transform: uppercase;
    font-family: 'Roboto', sans-serif;
    font-weight: 400;
    color: #FFFFFF;
    text-align: center;
    transition: all 0.15s;
    background-color: royalblue;
  }

  button:hover {
    color: #DDDDDD;
    border-color: #DDDDDD;
  }

  button:active {
    color: #BBBBBB;
    border-color: #BBBBBB;
  }

  @media all and (max-width:30em) {
    button {
      display: block;
      margin: 0.4em auto;
    }
  }
</style>

<head></head>

<body>
  <div id="settings" class="row">
    <button id="start">Start</button>
    <p>Score:</p>
    <div class="quantity">
      <input name="answerQuantity" id="answerQuantity" type="number" min="1" max="15" step="1" value="10">
      <select name="difficulty" id="difficulty">
        <option value="easy">easy</option>
        <option value="medium">medium</option>
        <option value="hard">hard</option>
      </select>

    </div>
  </div>
  <div id="question" class="row">
    <h1></h1>
    <p></p>
  </div>

  <div id="answers" class="row">

    <div id="answersWrapper">
      <div class="row">
        <button class="multipleOption" hidden=true> </button>
        <button class="multipleOption" hidden=true> </button>
      </div>
      <div class="row">
        <button class="multipleOption" hidden=true> </button>
        <button class="multipleOption" hidden=true> </button>
      </div>
      <div class="row">
        <button class="booleanOption" hidden=true> </button>
        <button class="booleanOption" hidden=true> </button>
      </div>
    </div>

  </div>
  <script>
    var questions = [
      {
        category: "Science: Computers",
        type: "multiple",
        difficulty: "easy",
        question: "What does CPU stand for?",
        correct_answer: "Central Processing Unit",
        incorrect_answers: [
          "Central Process Unit",
          "Computer Personal Unit",
          "Central Processor Unit",
        ],
      },
      {
        category: "Science: Computers",
        type: "multiple",
        difficulty: "easy",
        question:
          "In the programming language Java, which of these keywords would you put on a variable to make sure it doesn&#039;t get modified?",
        correct_answer: "Final",
        incorrect_answers: ["Static", "Private", "Public"],
      },
      {
        category: "Science: Computers",
        type: "boolean",
        difficulty: "easy",
        question: "The logo for Snapchat is a Bell.",
        correct_answer: "False",
        incorrect_answers: ["True"],
      },
      {
        category: "Science: Computers",
        type: "boolean",
        difficulty: "easy",
        question:
          "Pointers were not used in the original C programming language; they were added later on in C++.",
        correct_answer: "False",
        incorrect_answers: ["True"],
      },
      {
        category: "Science: Computers",
        type: "multiple",
        difficulty: "easy",
        question:
          "What is the most preferred image format used for logos in the Wikimedia database?",
        correct_answer: ".svg",
        incorrect_answers: [".png", ".jpeg", ".gif"],
      },
      {
        category: "Science: Computers",
        type: "multiple",
        difficulty: "easy",
        question: "In web design, what does CSS stand for?",
        correct_answer: "Cascading Style Sheet",
        incorrect_answers: [
          "Counter Strike: Source",
          "Corrective Style Sheet",
          "Computer Style Sheet",
        ],
      },
      {
        category: "Science: Computers",
        type: "multiple",
        difficulty: "easy",
        question:
          "What is the code name for the mobile operating system Android 7.0?",
        correct_answer: "Nougat",
        incorrect_answers: [
          "Ice Cream Sandwich",
          "Jelly Bean",
          "Marshmallow",
        ],
      },
      {
        category: "Science: Computers",
        type: "multiple",
        difficulty: "easy",
        question: "On Twitter, what is the character limit for a Tweet?",
        correct_answer: "140",
        incorrect_answers: ["120", "160", "100"],
      },
      {
        category: "Science: Computers",
        type: "boolean",
        difficulty: "easy",
        question: "Linux was first created as an alternative to Windows XP.",
        correct_answer: "False",
        incorrect_answers: ["True"],
      },
      {
        category: "Science: Computers",
        type: "multiple",
        difficulty: "easy",
        question:
          "Which programming language shares its name with an island in Indonesia?",
        correct_answer: "Java",
        incorrect_answers: ["Python", "C", "Jakarta"],
      },
    ];

    window.onload = function () {
      //IF YOU ARE DISPLAYING ALL THE QUESTIONS TOGETHER:
      //HINT: for each question, create a container with the "question"
      //create a radio button https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/radio with, as option the both the correct answer and the incorrect answers
      //when EVERY question has an answer (google for how to get a value from a radio button with JS)
      //IF YOU ARE DISPLAYING ONE QUESTION AT A TIME
      //Display first question with a title + radio button
      //when the user select the answer, pick the next question and remove this from the page after added in a varible the users' choice.

      //HELPER FUNCTIONS
      function unescapeHtml(unsafe) {
        return unsafe
          .replace(/&amp;/g, "&")
          .replace(/&lt;/g, "<")
          .replace(/&gt;/g, ">")
          .replace(/&quot;/g, "\"")
          .replace(/&#039;/g, "'");
      }

      const $ = function (cssQuery, arrFlag) {
        a = document.querySelectorAll(cssQuery)
        if (!!arrFlag) return a
        else return a[0]
      }
      const clearEventListener = function (element) {
        //trick for remove all event listeners because i want use anon functions as Event handlers
        const clonedElement = element.cloneNode(true);
        element.replaceWith(clonedElement);
        return clonedElement;
      }
      const shuffle = function (array) {
        var currentIndex = array.length, temporaryValue, randomIndex;

        // While there remain elements to shuffle...
        while (0 !== currentIndex) {

          // Pick a remaining element...
          randomIndex = Math.floor(Math.random() * currentIndex);
          currentIndex -= 1;

          // And swap it with the current element.
          temporaryValue = array[currentIndex];
          array[currentIndex] = array[randomIndex];
          array[randomIndex] = temporaryValue;
        }

        return array;
      }

      //General Variables
      let state = {
        amount: 10,
        difficulty: "easy",
        answers: [],
        score: 0,
        maxScore: questions.length
      }


      //Components Logic

      const answerNext = () => {
        if (state.answers.length === questions.length) return null
        $('#settings>p').innerText = "Score: " + state.score
        let nQ = state.answers.length + 1
        loadQuestion(nQ)
        answerInputActivation(nQ)

      }

      const loadQuestion = (qstN) => {
        let H1Node = $("#question>h1")
        H1Node.innerText = questions[qstN - 1].category
        let pNode = $('#question>p')
        pNode.innerText = '\n' + unescapeHtml( questions[qstN - 1] .question )
      }





      //activate buttons with question num returning an objs with refs, 
      //deactivate buttons with flag false
      const answerInputActivation = function (qstN) {
        if (qstN !== false) {
          qstN-- //for make human indexing -->array indexing 
          let answerArray = [
            {
              text: questions[qstN].correct_answer,
              correct: true,
              btnRef: null
            },
            ...questions[qstN].incorrect_answers.map(
              (e, i, a) => {
                return { text: e, correct: false, btnRef: null }
              })
          ]

          answerArray = shuffle(answerArray)


          let btnArray
          switch (questions[qstN].type) {
            case 'multiple':
              btnArray = $(".multipleOption", true)
              break
            case 'boolean':
              btnArray = $(".booleanOption", true)
              break
          }
          btnArray.forEach(
            (el, i) => {
              answerArray[i].ref = el
              el.innerText = answerArray[i].text
              //there was the case of closure for avoid code duplication

              if (answerArray[i].correct) {
                el.addEventListener('click',
                  (e) => {
                    e.target.classList.add('correct-answer')
                    state.answers.push(answerArray[i])
                    state.score = state.score + 1
                    setTimeout(() => answerInputActivation(false), 1000)
                    setTimeout(() => answerNext(), 2000)

                  })
              }
              else {
                el.addEventListener('click',
                  (e) => {
                    e.target.classList.add('incorrect-answer')
                    state.answers.push(answerArray[i])
                    state.score = state.score
                    setTimeout(() => answerInputActivation(false), 1000)
                    setTimeout(() => answerNext(), 2000)
                  })
              }
              el.removeAttribute('hidden')
            });
        }
        else {
          $('#answersWrapper button', true)
            .forEach(el => {
              el.classList.remove('correct-answer')
              el.classList.remove('incorrect-answer')
              el.setAttribute('hidden', true)
              clearEventListener(el)
            })
        }
      }
      const getParameters = function () {

      }

      const loadDoc = function (amount, difficulty) {
        let xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
          if (this.readyState == 4 && this.status == 200) {
            questions = JSON.parse( this.responseText ).results
            setTimeout(() => answerNext(), 1500)
          }
        };
        xhttp.open("GET", `https://opentdb.com/api.php?amount=${amount}&category=18&difficulty=${difficulty}`, true);
        xhttp.send();
      }

      //MAIN
      $('#start').addEventListener('click', function () {
        loadDoc($('#answerQuantity').value, $('#difficulty').value)
        //answerNext()
      })
    };


      //HOW TO calculate the result
      //You can do it in 2 ways:
      //If you are presenting all questions together, just take all the radio buttons and check if the selected answer === correct_answer
      //If you are presenting one question at a time, just add one point or not to the user score if the selected answer === correct_answer
  </script>
</body>

</html>